if(johnLewis.Module===undefined||typeof johnLewis.Module!=="object"){johnLewis.Module={}}johnLewis.Module.shopByBrand=function(){var H=$(".brands-alphabet");var c=$(".brands-alphabet-sticky-border");var e=$(".brands-alphabet-header");var G=$(".brands-alphabet-title");var j=$(".brands-alphabet-expanded");var y=$("#search-brands-form");var Z=$("#search-bar-brand");var q=$(".brand-space-search-again");var F=$("#failed-search-term");var Y=$(".brand-entry a");var B=$(".back-to-top a");var d=$("#end-of-list");var D={BRAND_SEARCH:"Brand Search",A_TO_Z_SEARCH:"A-Z Search",BRAND_SCROLL:"Brand Scroll"};var aa=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);var m=$("html").is(".ie6, .ie7, .ie8");var J=true;var u;var g=[];var U={};var s="";var Q={};var o={};var w=false;var ab=[".","-","'"];var C=["&","and","+"];var p={"&":C,and:C,"+":C};var X;var N=400;var b=true;var ad={};var n=function(ah){this.searchText=A(jQuery.trim(ah.toLowerCase()));this.tokens=S(this.searchText);this.letterIndexes={};for(var ag=0;ag<this.tokens.length;ag++){this.letterIndexes[this.tokens[ag].substring(0,1)]=true}};var f=function(ah,ag){this.matchedToken=ah;this.searchToken=ag};var a=function(ag){this.originalText=ag;this.normalizedText=A(jQuery.trim(ag));this.letterIndexes={};this.rootNode=new K(this.normalizedText);this.rootNode.appendLetterIndexes(this.letterIndexes);this.matchResults=[];this.resetMatches=function(){this.rootNode.resetMatches();this.matchResults=[]};this.matches=function(ai){this.resetMatches();for(var aj=0;aj<ai.tokens.length;aj++){var ah=this.rootNode.findAndSetMatchingNode(ai.tokens[aj]);if(!ah){return false}this.matchResults.push(ah)}return this.matchResults}};var K=function(ag){this.aliases=[];this.childNodes=[];this.matched=false;if(ag instanceof Array){for(var ak=0;ak<ag.length;ak++){if(ag[ak].length){this.childNodes.push(new K(ag[ak]))}}return}if(p[ag]){var am=p[ag];for(var ak=0;ak<am.length;ak++){this.addAlias(am[ak])}return}if(ag.length==1){this.addAlias(ag);return}if(ag.indexOf(" ")>=0){var ah=ag.match(/\b\w/g);var al="";for(var ak=0;ak<ah.length;ak++){al+=ah[ak]}this.addAlias(al);var an=ag.match(/([\w&\+]\s([\w&\+]$)?){1,3}|\S+/g);for(var ak=0;ak<an.length;ak++){if(an[ak].indexOf(" ")){this.childNodes.push(new K(an[ak].replaceAll(" ","")))}else{this.childNodes.push(new K(an[ak]))}}}else{if(ag.match(/^[\A-Z0-9&\+]{2,4}$/)){this.addAlias(new K(ag.split("")));this.addAlias(ag)}else{this.addAlias(ag);for(var ak=0;ak<ab.length;ak++){var ao=ab[ak];if(ag.indexOf(ao)>-1){var ai=ag.split(ao);this.addAlias(new K(ai));var aj=ag.replaceAll(ao,"");this.addAlias(aj)}}}}};K.prototype.addAlias=function(ag){if(typeof ag=="string"){this.aliases.push(ag.toLowerCase())}else{this.aliases.push(ag)}};K.prototype.resetMatches=function(){this.matched=false;for(var ag=0;ag<this.childNodes.length;ag++){this.childNodes[ag].resetMatches()}for(var ag=0;ag<this.aliases.length;ag++){if(this.aliases[ag].constructor==K){this.aliases[ag].resetMatches()}}};K.prototype.findAndSetMatchingNode=function(ah){if(this.matched){return false}for(var ag=0;ag<this.childNodes.length;ag++){var ai=this.childNodes[ag].findAndSetMatchingNode(ah);if(ai){return ai}}for(var ag=0;ag<this.aliases.length;ag++){if(this.aliases[ag].constructor==K){var ai=this.aliases[ag].findAndSetMatchingNode(ah);if(ai){return ai}}}for(var ag=0;ag<this.aliases.length;ag++){if(this.aliases[ag].constructor!=K){ad.numTokensChecked++;if(this.aliases[ag].indexOf(ah)==0){this.matched=true;ad.numTokenChecksSuccessful++;return new f(this.aliases[ag],ah)}}}return false};K.prototype.appendLetterIndexes=function(ag){for(var ai=0;ai<this.childNodes.length;ai++){this.childNodes[ai].appendLetterIndexes(ag)}for(var ai=0;ai<this.aliases.length;ai++){var ah=this.aliases[ai];if(ah.constructor==K){ah.appendLetterIndexes(ag)}else{ag[ah.substring(0,1)]=true}}};var i=function(ah,ag){this.elem=ah;this.linkElem=$(ah).find("a");this.containerElem=ag;this.containerLetter=$(this.containerElem).data("brand-letter");this.columnIndex=0;this.rawName=jQuery.trim($(ah).find("a").text());this.tokenTree=new a(this.rawName);this.name=this.tokenTree.normalizedText;this.getHighlightedRawName=function(aA){var au=A(aA);var av=new RegExp("\\b"+au,"i");var am=av.exec(this.name);var ap=-1;if(am){ap=am.index}if(ap>=0){var al=this.rawName.substring(ap,ap+aA.length);return this.rawName.replace(al,"<b>"+al+"</b>")}else{var az="";var at=false;var an=this.rawName.match(/([0-9A-Za-z\u00C0-\u017F&\+]+)|([.'\-])|(\s)/g);var aC=this.tokenTree.matchResults.slice(0);for(var ay=0;ay<an.length;ay++){var aq=an[ay];if(aq!=" "){var aw=0;var ar=aq.toLowerCase();for(var ax=0;ax<aC.length;ax++){var ak=aC[ax];if(ar==ak.matchedToken){aw=ak.searchToken.length;aC.splice(ax,1);break}}if(aw){at=true;aq="<b>"+aq.substring(0,aw)+"</b>"+aq.substring(aw)}}az+=aq}if(at){return az}}var ao=A(jQuery.trim(this.rawName.toLowerCase()));var aj=aA.replace(/[ '.-]/g,"");var ai=ao.match(aj);if(ai){var aB=this.rawName.substr(ai.index,ai[0].length);return this.rawName.replace(aB,"<b>"+aB+"</b>")}return this.rawName}};var M=function(ag){this.elem=ag;this.searchResultsElem=$(ag).find(".brand-names-container-search-results");this.letter=$(ag).data("brand-letter");this.matchedBrands=[];this.hideAllSearchResults=function(){$(this.searchResultsElem).find(".brand-entry").addClass("hidden")};this.moveBrandEntryToColumnIndex=function(ah,aj){if(ah.columnIndex!=aj){var ai=$(this.searchResultsElem).find(".brand-names-column ul").eq(aj);$(ah.elem).detach().appendTo(ai);ah.columnIndex=aj}}};var I=function(){return y.position().top+210};var T=function(){return $("#brands-letter-container-z").position().top-c.height()};var k=function(){if(w){return H.position().top+c.height()}else{return H.position().top+H.height()}};var S=function(ak){var aj=[];var ag=A(jQuery.trim(ak.toLowerCase()));var ai=ag.split(/[\s,.'\-]+/);for(var ah=0;ah<ai.length;ah++){if(ai[ah].length){aj.push(ai[ah])}}return aj};var A=function(aj){var ag=/[öäüáàâéèêúùûóòôåÅãõ]/g;var ai={"ä":"a","ö":"o","ü":"u","á":"a","à":"a","â":"a","é":"e","è":"e","ê":"e","ú":"u","ù":"u","û":"u","ó":"o","ò":"o","ô":"o","å":"a","Å":"a","ã":"a","õ":"o"};var ah=function(ak){return ai[ak]||ak};return aj.replace(ag,ah)};var L=function(){ad={numBrandNamesChecked:0,numTokensChecked:0,numBrandNameChecksSuccessful:0,numTokenChecksSuccessful:0}};var O=function(){var ag=jQuery.parseJSON($("#shop-by-brand-data").html());Q=ag.textAndLabels;o=ag.displayConfig};var l=function(ag){u=ag;x()};var x=function(){if(isLocalStorageSupported()){localStorage.setItem("typedsearch",u)}};var E=function(){return $(".search-brands").length};var ac=function(ag,ai,ah){var ah=ah||800;$("html, body").stop().animate({scrollTop:ag},ah,"swing",function(){if(ai){var aj=$(window).scrollTop();window.location.hash=ai;$("html,body").scrollTop(aj)}})};var W=function(ag){var ah=ag.toLowerCase();ah=ah.replaceAll('"'," ");ah=jQuery.trim(ah);if(ah!==s){r(false);s=ah;if(ah.length<o.minSearchCharacters){z();l(D.BRAND_SCROLL)}else{clearTimeout(X);X=setTimeout(function(){af(s)},N)}}};var af=function(au){clearTimeout(X);t(false);l(D.BRAND_SEARCH);var am=new n(au);var ao=false;L();for(var aj in U){U[aj].matchedBrands=[]}var ak=[];for(var ap in g){var ai=g[ap];var aw=false;for(var an in am.letterIndexes){if(!ai.tokenTree.letterIndexes[an]){aw=true;break}}if(!aw){ak.push(ai)}}for(var ap in ak){var ai=ak[ap];var ah=ai.tokenTree.matches(am);ad.numBrandNamesChecked++;if(ah){ad.numBrandNameChecksSuccessful++;var av=U[ai.containerLetter].matchedBrands;av.push(ai);ao=true}}if(!ao){r(true);return}for(var aj in U){var ag=U[aj];var av=ag.matchedBrands;var at=av.length;if(at>0){ag.hideAllSearchResults();var aq=V(at);var ar=0;for(var ap in av){var al=av[ap];$(al.linkElem).html(al.getHighlightedRawName(au));$(al.elem).removeClass("hidden");if((ap>0)&&ap%aq==0){ar++}ag.moveBrandEntryToColumnIndex(al,ar)}$(ag.elem).removeClass("hidden")}else{$(ag.elem).addClass("hidden")}}R(true)};var V=function(ah){var ag=o.minBrandsPerColumn;if(ah>o.minBrandsPerColumn){ag=parseInt(ah/o.numBrandColumns);if((ah%o.numBrandColumns)>0){ag++}}return ag};var r=function(ag){if(ag){$(F).html('"'+s+'"');$(q).removeClass("hidden");R(false);l(D.BRAND_SCROLL);fn_sc.track_brandSearchError(s)}else{$(q).addClass("hidden")}};var h=function(ag){B.addClass("hidden");$(".brands-letter-container").not("#brands-letter-container-"+ag).addClass("hidden");$("#brands-letter-container-"+ag).removeClass("hidden")};var z=function(){R(false)};var R=function(ag){B.removeClass("hidden");if(ag){$(".brand-names-container-search-results").removeClass("hidden");$(".brand-names-container-static").addClass("hidden")}else{$(".brand-names-container-search-results").addClass("hidden");$(".brand-names-container-static").removeClass("hidden");$(".brands-letter-container").removeClass("hidden")}b=true};var t=function(ag){if(ag){$(j).slideDown("fast");$(G).html(Q.hideAToZ);$(H).addClass("active");ae()}else{$(j).slideUp("fast");$(G).html(Q.wantToBrowseByAToZ);$(H).removeClass("active")}};var ae=function(){r(false);$(Z).val(Q.searchPlaceholderText);currentSearchTerm="";z()};var v=function(){$(Y).click(function(ah){x()}).bind("mouseup",function(ah){if(ah.which==2){x()}});$(e).click(function(){if($(H).hasClass("active")){t(false)}else{t(true)}});$(".brands-alphabet .brands-alphabet-letter a").bind("click",function(ak){ak.preventDefault();var aj=this.hash;l(D.A_TO_Z_SEARCH);if(aa){if(aj=="#all"){z()}else{h(aj.substring(1))}}else{var ah=$("a."+aj);var ai=ah.offset().top;if(w){ai-=c.height()}else{ai-=H.height()-5}if($(window).scrollTop()==ai){return}ac(ai,aj)}});B.bind("click",function(ai){ai.preventDefault();var aj=$(window).scrollTop();var ak=Modernizr.touch;if(!ak){ac(I(),"","")}else{var ah=aj*0.1;if(ah<350){ah=350}if(ah>2000){ah=2250}ac(I(),"",ah)}});$(Z).bind("focus",function(){$(y).addClass("active");if($(this).val()==Q.searchPlaceholderText){$(this).val("")}$("html, body").animate({scrollTop:I()},500)}).bind("blur",function(){$(y).removeClass("active");if(!jQuery.trim($(this).val())){$(this).val(Q.searchPlaceholderText)}}).bind("keyup",function(ai){var ah=$(this).val();W(ah);if(ai.keyCode==13){$(this).blur();return false}});$(y).submit(function(ah){ah.preventDefault()});if(!aa){var ag=setInterval(function(){if($(window).scrollTop()>T()){$(H).addClass("sticky-locked")}else{if($(window).scrollTop()>=k()){$(H).removeClass("sticky-locked");$(H).addClass("sticky");w=true}else{$(H).removeClass("sticky").removeClass("sticky-locked");w=false}}},200)}};var P=function(){$(".brands-letter-container").each(function(){var aj=$(this);var ag=new M($(this));U[ag.letter]=ag;var ai=$(this).find(".brand-names-container-search-results .brand-names-column ul").eq(0);var ah=document.createElement("ul");$(this).find(".brand-entry").each(function(){var al=$(this).clone();$(ah).append(al);var ak=new i($(al),aj);g.push(ak)});$(ai).replaceWith(ah)})};$(document).ready(function(){if(E()){O();v();l(D.BRAND_SCROLL);if(J){P()}}});return{isSearchCompleted:function(){return b}}}();